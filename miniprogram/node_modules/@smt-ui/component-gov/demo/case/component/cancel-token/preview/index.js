/**
 * @file index.js
 * @author swan
 * @date 2020-04-08
 */

import {CancelToken, genFetch} from '../../../../../src/common/utils/cancelToken';

Page({
    data: {
        list: []
    },
    async reqHdl(text) {
        this.setData({
            list: []
        });
        const res = await genFetch('https://www.studyinghome.com/mock/5e5e40f16b63043d83e13a95/example/list', {
            method: 'GET',
            cancelToken: new CancelToken(c => {
                this.reqCancel = c;
                return;
            })
        });
        const {code, msg, data} = res.data;
        if (code) {
            swan.showToast({
                title: msg
            });
            return;
        }
        swan.showToast({
            title: '请求成功'
        });
        this.setData({
            list: data.list
        });
    },

    // 中止请求
    abortHdl() {
        typeof this.reqCancel === 'function' && this.reqCancel();
    }
});
