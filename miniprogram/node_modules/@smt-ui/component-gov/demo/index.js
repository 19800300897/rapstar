/**
 * @file 测试脚本
 * @author LipengJia<jialipeng@baidu.com>
 * @date 2019-12-19
 */

const childProc = require('child_process');
const {setting, use, preset} = require('./config.json');

const version = process.version.match(/v(\d+)\./)[1];
if (version < 10) {
    return console.error('请升级node版本至v10及以上');
}

const main = () => {
    const userConf = setting[use];
    if (!userConf) {
        return console.error('未找到use对应配置，请检查 test/config ');
    }
    const {devtoolsPath, projectPath, platform} = userConf;
    const p = platform || preset.platform;
    if (p === 'devtools') {
        const cmd = `${devtoolsPath} --ctsTest --device-type ${p} --projectPath=${projectPath}`
                    + ' --projectName=smt-ui --projectType=program';
        childProc.exec(cmd, err => {
            if (err) {
                return console.error('错误信息：', err);
            }
        });
        return process.exit(0);
    }
};

main();


