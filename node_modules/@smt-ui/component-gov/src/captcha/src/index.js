/**
 * @file 图片验证输入框组件
 * @author swan
 */

/* globals Component, swan */

Component({
    externalClasses: [
        // 左侧文字
        'gov-code',
        // input输入框样式
        'gov-input'
    ],
    properties: {
        // 定义了name属性，可以在使用组件时，由外部传入。此变量可以直接在组件模板中使用
        // 输入区域的宽度 默认四字折行
        iptAreaWidth: {
            type: String,
            value: '4em'
        },
        // 输入框名字
        iptName: {
            type: String,
            value: ''
        },
        // 占位文案
        placeholderContent: {
            type: String,
            value: '请输入验证码'
        },
        // 输入框value
        iptValue: {
            type: String,
            value: ''
        },
        // input类型：text、number、idcard、digit
        type: {
            type: String,
            value: 'text'
        },
        // 输入最大长度
        maxlength: {
            type: Number,
            value: 4
        },
        // 获取聚焦，调起键盘
        focus: {
            type: Boolean,
            value: false
        },
        // 图片验证码的url地址
        verifyImgUrl: {
            type: String,
            value: '',
            observer(n) {
                n && this.verifyImgUrlData(n);
            }
        },
        // 验证码是否输入错误
        iptErrorInfo: {
            type: Boolean,
            value: false
        }
    },
    data: {
        status: 0
    },
    methods: {
        /**
         * 图片加载成功
         */

        imgHdl() {
            this.status = 1;
        },

        /**
         * 输入事件
         */
        bindKeyInput({detail}) {
            this.setData({
                iptValue: detail.value
            });
            const iptname = this.data.iptName || '';
            const iptid = this.data.id || '';
            const iptResult = {
                iptid,
                iptname,
                iptvalue: detail.value
            };
            this.triggerEvent('keyinput', iptResult);
        },

        /**
         * 点击键盘完成时
         */
        bindConfirm() {
            this.triggerEvent('iptconfirm');
        },

        /**
         * 失焦事件
         */
        bindBlur({detail}) {
            const iptname = this.data.iptName || '';
            const iptid = this.data.id || '';
            const iptResult = {
                iptid,
                iptname,
                iptvalue: detail.value
            };
            this.triggerEvent('iptblur', iptResult);
        },

        /**
         * 聚焦事件
         */
        bindFocus() {
            this.setData({
                iptErrorInfo: false
            });
            const iptid = this.data.id || '';
            const iptResult = {
                iptid
            };
            this.triggerEvent('iptfocus', iptResult);
        },
        /**
         * 刷新验证码
         */
        refreshImg() {
            this.setData({
                status: 2,
                verifyImgUrl: '',
                iptvalue: ''
            });
            this.triggerEvent('refreshimg');
        },

        /**
         * 重置图片路径
         *
         * @param {String} verifyImgUrl 图片路径
         */
        verifyImgUrlData(verifyImgUrl) {
            this.setData({
                verifyImgUrl
            });
        }
    }
});
