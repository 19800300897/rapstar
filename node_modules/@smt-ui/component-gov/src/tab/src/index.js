/**
 * @file index.js
 * @author LipengJia <jialipeng@baidu.com>
 * @date 2020-01-02
 */

import {isIos} from '../../common/utils/index';

Component({
    properties: {
        activeName: {
            type: String,
            value: '',
            observer(n) {
                const activeTarget = this.child[n];
                if (activeTarget) {
                    Object.values(this.child).forEach(el => {
                        el.setActive(false);
                        el.setWidth(`${(100 / this.count).toFixed(3)}vw`);
                    });
                    activeTarget.setActive(true);
                }
            }
        }
    },

    messages: {
        itemUpdate({target, value}) {
            if (this.child[value] == null) {
                this.count++;
            }
            else {
                console.error('tab-item存在相同name，可能出错');
            }
            this.child[value] = target;
        },

        itemTap({value}) {
            if (value === this.data.activeName || !value) {
                return;
            }
            this.triggerEvent('change', value);
        }
    },

    data: {
        isIos
    },

    created() {
        this.child = {};
        this.count = 0;
    }
});
