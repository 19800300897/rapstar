/**
 * @file filter-single-list组件
 * @author huangjing02
 */

/* globals Page, swan, getApp, getCurrentPages */
import {isIos} from '../../common/utils/index';
import {COLOR_TIPS_RED, COLOR_BLACK} from '../../common/style/color';


Component({

    externalClasses: [
        'gov-filter-singlelist'
    ],

    properties: {
        // 筛选器ID
        options: {
            type: Array,
            value: []
        },

        // 筛选项数组，数组格式[{text:'名称', value: '值，string/Array.<string>', options: [{text: '', value: ''}, {text: '', value: ''}]}]
        optionKey: {
            type: String,
            value: '',
            observer(n) {
                this.setData({
                    currOptionKey: n || 'text'
                });
            }
        },

        value: {
            type: String,
            value: ''
        },

        // 高亮时的文字和icon颜色
        activeColor: {
            type: String,
            value: COLOR_TIPS_RED
        },

        // 默认状态的文字颜色
        fontColor: {
            type: String,
            value: COLOR_BLACK
        }
    },

    data: {
        // 是否ios
        isIos,
        // 当前选中key
        currOptionKey: ''
    },

    methods: {
        selHdl(e) {
            let {value, key, idx} = e.currentTarget.dataset;
            this.selInnerHdl(value, key, idx);
        },

        selInnerHdl(value, text, index, fillback = false) {
            this.triggerEvent('change', {
                type: 'singleList',
                index,
                text,
                value,
                fillback
            });
        },
        setValue(val) {
            for (const [idx, opt] of this.data.options.entries()) {
                if (opt.value === val) {
                    return this.selInnerHdl(val, opt[this.data.currOptionKey] || opt, idx, true);
                }
            }
        }
    }
});
