import {upx2dpx} from '../../common/utils/px';
import {
    COLOR_TIPS_RED,
    COLOR_RED_LIGHT,
    COLOR_WHITE,
    COLOR_GRAY_4
} from '../../common/style/color';
Component({
    externalClasses: [
        'gov-checkbox'
    ],
    properties: {
        value: {
            type: Boolean,
            value: false,
            observer(n) {
                this.updateIcon();
            }
        },
        inline: {
            type: Boolean,
            value: false
        },
        disabled: {
            type: Boolean,
            value: false,
            observer(n) {
                this.updateIcon();
            }
        },
        itemStyle: {
            type: Object,
            value: {},
            observer(n) {
                this.setData('currentItemSty', n);
            }
        },
        iconStyle: {
            type: Object,
            value: {}
        },
        twoColumn: {
            type: Boolean,
            value: false
        },
        inFilter: {
            type: Boolean,
            value: false
        },
        activeColor: {
            type: String,
            value: COLOR_TIPS_RED
        },
        activeBgColor: {
            type: String,
            value: COLOR_RED_LIGHT
        }
    },
    data: {
        iconStyl: {},
        currentItemSty: {},
        showIcon: false
    },
    created() {
        this.updateIcon();
    },
    methods: {
        clkHdl() {
            const checked = !this.data.value;

            this.triggerEvent('click', {disabled: this.data.disabled, checked});
            if (this.data.disabled) {
                return;
            }

            this.setData({
                value: checked
            });

            this.triggerEvent('change', checked);
        },
        updateIcon() {
            let {
                inline,
                value,
                disabled,
                inFilter,
                showIcon,
                activeColor,
                activeBgColor
            } = this.data;

            let icon = {
                name: '',
                size: '',
                color: ''
            };
            // 如果是行内模式
            if (inline) {
                // 非选中
                if (!value) {
                    showIcon = false;
                }
                else {
                    showIcon = true;
                    icon.color = [activeColor, COLOR_WHITE];
                    // 如果是在筛选器内，样式覆盖
                    if (inFilter) {
                        icon.size = upx2dpx(50) + 'px';
                        icon.name = 'checked-s';

                    }
                    else {
                        icon.size = upx2dpx(66) + 'px';
                        icon.name = 'checked-l';
                    }
                }

            }
            else {
                showIcon = true;
                icon.size = upx2dpx(66) + 'px';
                // 禁用
                if (disabled) {
                    icon.name = 'radio-forbid';
                    icon.color = ['#f1f1f1', COLOR_GRAY_4];
                }
                // 非选中
                else if (!value) {
                    icon.name = 'radio-uncheck';
                    icon.color = COLOR_GRAY_4;
                }
                else {
                    icon.name = 'complete';
                    icon.color = [activeColor, COLOR_WHITE];
                }
            }
            this.setData({
                iconStyl: icon,
                showIcon,
                currentItemSty: {
                    ...this.data.itemStyle,
                    color: value && inline ? activeColor : '',
                    'background-color': value && inline ? activeBgColor : ''
                }
            });
        }
    }
});
