/**
 * @file 图形验证码
 * @author swan
 * @date 2020-04-08
 */


/* globals Page, swan */
Page({
    data: {
        btnStatus: false,
        iptdefault: 'rrgk',
        vcodeData: {
            type: 'text',
            maxLength: 4,
            focus: false,
            placeholderContent: '请输入验证码',
            defaultValue: '',
            iptName: 'verifycode',
            iptErrorFlag: false,
            value: '',
            verifyImgUrl: 'https://images2015.cnblogs.com/blog/908744/201703/908744-20170303142728141-434774652.png'
        }
    },
    tosee() {// 获取子组件实例
        console.log(this.selectComponent('#vcodeData'));
    },
    iptKeyInput({detail}) {// 捕获input子组件的keyinput
        this.setData({
            value: detail.iptvalue
        });
        console.log('输入组件发生了keyinput事件，携带数据为：', detail);
    },
    iptBlur({detail}) {// 捕获input子组件的blur事件
        console.log('输入组件发生了blur事件，携带数据为：', detail);
    },
    iptFocus(e) {// 捕获input子组件的focus事件
        console.log('输入组件发生了focus事件，携带数据为：', e.detail);
    },
    iptConfirm() {// 捕获input子组件的confirm事件
        console.log('输入组件发生了confirm事件');
    },
    submitHdl() {// 提交表单
        if (!this.data.value) {
            return;
        }
        const flag = this.data.value.toLocaleLowerCase() === this.data.iptdefault;
        if (flag) {
            this.setData({
                'vcodeData.iptErrorFlag': false
            });
            swan.showToast({
                title: '输入正确',
                icon: 'success'
            });
        }
        else {
            this.setData({
                'vcodeData.iptErrorFlag': true
            });
            this.refreshVerifyImg();
        }
    },
    refreshVerifyImg() {
        const imgs = ['https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1583250051682&di=11240eeaa67d2c2d30f934869d395ddf&imgtype=0&src=http%3A%2F%2Fi0.hdslb.com%2Fbfs%2Farticle%2F0a10e76210f5c315da85010803f3d3b26fc8d2c4.png', 'https://images2015.cnblogs.com/blog/908744/201703/908744-20170303142728141-434774652.png'];
        const ind = this.data.iptdefault === 'rrgk' ? 0 : 1;
        this.setData({
            'iptdefault': ind ? 'rrgk' : '6220',
            'vcodeData.verifyImgUrl': imgs[ind]
        });
    }
});