/**
 * @file 保存行覆盖率方法
 * @author wangwenhan01
 */
const fs = require('fs');
const {resolve} = require('path');

/**
 *
 * @param {Object} coverage 对象
 */
const saveCoverage = coverage => new Promise((r, j) => {
    try {
        let fileName = new Date().getTime();
        fileName = fileName + '.json';
        let dirPath = resolve(__dirname, '../../../coverage/output');
        let jsonPath = resolve(dirPath, fileName);
        // 创建行覆盖率临时文件夹
        if (!fs.existsSync(dirPath)) {
            fs.mkdirSync(dirPath);
        }
        // 保存行覆盖率json
        let temp = JSON.stringify(coverage);
        fs.writeFile(jsonPath, temp, err => {
            if (err) {
                throw err;
            }
            r();
        });
    }
    catch (e) {
        j(e);
    }
});

module.exports = {
    saveCoverage
};
