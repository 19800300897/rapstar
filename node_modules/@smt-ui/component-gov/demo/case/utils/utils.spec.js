/**
 * @file utils.spec.js
 * @author LipengJia <jialipeng@baidu.com>
 * @date 2020-01-07
 */

import assert from 'assert';
import {preventRepeat} from '@utils/index';

describe('preventRepeat', () => {
    it('设定1800ms内只能执行一次', done => {
        let i = 0;
        const add = () => i++;
        const timer = setInterval(() => {
            const exec = () => preventRepeat(add, 2000);
            exec();
        }, 100);

        setTimeout(() => {
            clearInterval(timer);
            assert.strictEqual(i, 1);
            done();
        }, 1800);
    });

    // 为啥执行时间多了300ms ？
    // it('设定回调函数执行一次', done => {
    //     let i = 0;
    //     const add = () => i++;
    //     const timer = setInterval(() => {
    //         const exec = () => preventRepeat(finish => {
    //             setTimeout(() => {
    //                 clearInterval(timer);
    //                 finish();
    //                 assert.strictEqual(i, 1);
    //                 done();
    //             }, 1800);
    //             add();
    //         });
    //         exec();
    //     }, 100);
    // });

    it('设定1800毫秒内回调函数执行一次', done => {
        let i = 0;
        const add = () => i++;
        let f;
        const timer = setInterval(() => {
            const exec = () => preventRepeat(finish => {
                f = finish;
                add();
            });
            exec();
        }, 100);

        setTimeout(() => {
            clearInterval(timer);
            f();
            assert.strictEqual(i, 1);
            done();
        }, 1800);
    });
});
